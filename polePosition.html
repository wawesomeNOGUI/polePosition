<html>
<body style="margin: 0; padding: 0; overflow: hidden; background-color: black;">
    <style>
        #gameCanvas {
            margin: 0;
            padding: 0;

            /*border-style: solid;*/
            /*border-color: #A4FCD4;*/
            /*border-width: 20px;*/

            font-smooth: never;
            -webkit-font-smoothing : none;

            image-rendering: pixelated;
            image-rendering: crisp-edges;
        }
    </style>
<canvas id="gameCanvas"></canvas>

<script src="./atariPixelFont.js"></script>
<script>
var canvas = document.getElementById("gameCanvas");
var ctx = canvas.getContext("2d");
canvas.width = 256;  //Pole Position Resolution
canvas.height = 224;
canvas.style.width = ""+ window.innerWidth +"px";   // stretch canvas to fit screen
canvas.style.height = ""+ window.innerHeight +"px"; // ***TODO: maybe stretch canvas to always have correct ratio as game instead of fullscreen
ctx.imageSmoothingEnabled = false;

//=================Sprites==============================
var background = new Image();
    background.src = "sprites/Pole0000.png";

var carSprite = new Image();
    carSprite.src = "sprites/car.png";

var roadBase = new Image();
    roadBase.src = "sprites/roadBase.png";

var roadSection = new Image();
    roadSection.src = "sprites/roadSection.png";
//======================================================

//======================Vars============================
var topScore = 1600;
var score = 0;
var playTime = 60;
var speed = 1000;

// lap time
var centisecs = 0;
var secs = 0;

// road drawing variables
const NUM_ROAD_SECTIONS = 10;
const MAGIC_SCALE_NUM = 1.74;
const INITIAL_PU = 1.55;
const INITIAL_ROAD_HEIGHT_OFFSET = -15;
var pu = INITIAL_PU;
var roadHeightOffset = INITIAL_ROAD_HEIGHT_OFFSET;

//======================================================

function timing() {
    centisecs++;

    if (centisecs == 99) {
        centisecs = 0;
        secs++;
        playTime--;
    }
    pu += 0.001 * speed/10;
    roadHeightOffset += 0.1 * speed/15.2;
}
setInterval(timing, 10);


// ctx.fillRect(0, 0, canvas.width, canvas.height);
var tmp = 0;
function render() {
    // default background
    ctx.fillStyle = "black";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // ctx.drawImage(background, 0, 0);

    // markers for dev
    // ctx.fillStyle = "#FF0000";
    // ctx.fillRect(0, canvas.height - 51, 50, 1);
    // ctx.fillRect(canvas.width / 2 - 25, canvas.height - 118, 50, 1);

    // road
    // road base
    ctx.fillStyle = "#515151";
    ctx.fillRect(0, canvas.height - 20, canvas.width, 20);
    ctx.fillRect(canvas.width/2 - 1, canvas.height - 117, 2, 1);
    
    // moving road sections (draw frontmost first to furthest away)
    for (var i = 0; i < NUM_ROAD_SECTIONS; i++) {
        var thisScale = pu / (MAGIC_SCALE_NUM ** i); // repeated division by MAGIC_SCALE_NUM
        var widthOffset = (roadSection.width - (roadSection.width * thisScale)) / 2;
        var heightOffset = canvas.height + roadHeightOffset;
        for (var j = 0; j <= i; j++) {
            heightOffset -= roadSection.height * (pu / (MAGIC_SCALE_NUM ** j));
        }

        ctx.drawImage(roadSection, widthOffset, heightOffset, roadSection.width * thisScale, roadSection.height * thisScale);
    }

    // // reset road vars
    if (pu > 2.72) {
        pu = INITIAL_PU;
        roadHeightOffset = INITIAL_ROAD_HEIGHT_OFFSET;
    }

    // ctx.drawImage(roadSection, 13, canvas.height - roadBase.height - roadSection.height*pu, roadSection.width*pu, roadSection.height*pu);

    // car
    ctx.drawImage(carSprite, canvas.width/2 - carSprite.width/2 - 2, canvas.height - carSprite.height - 12);

    // Screen Text
    // gear
    drawColorText(ctx, "LO", "#FFFFFF", canvas.width - 16, canvas.height - 8);

    // score
    drawColorText(ctx, "TOP", "#ff8fae", 24, 8);
    drawColorText(ctx, "" + topScore, "#ff8fae", 56, 8);
    drawColorText(ctx, "SCORE", "#ffffff", 8, 24);
    drawColorText(ctx, "" + score, "#ffffff", 56, 24);

    // play time left
    drawColorText(ctx, "TIME", "#ffff70", 112, 8);
    drawColorText(ctx, "" + playTime, "#ffff70", 120, 24);

    // lap time
    drawColorText(ctx, "LAP", "#8fff70", 176, 8);
    drawColorText(ctx, "" + secs + "*" + centisecs, "#8fff70", 208, 8);

    // speed
    drawColorText(ctx, "SPEED", "#ffffff", 160, 24);
    drawColorText(ctx, "" + speed + "kmh", "#ffffff", 208, 24);
}
setInterval(render, 16);



window.addEventListener("keydown", function (event) {

});

window.addEventListener("resize", function(e){
    canvas.style.width = ""+ window.innerWidth +"px";
    canvas.style.height = ""+ window.innerHeight +"px";
});

window.addEventListener("contextmenu", function(e){
  e.preventDefault();   //stops right click bringing up a menu
});
</script>
</body>
</html>